@using BlazorAzureOpenAI.Services
@inject OpenAIService AI
@inject SearchService Search

<h3>Chat With Your Data (RAG)</h3>

<input @bind="question" class="form-control" />
<button class="btn btn-warning mt-2" @onclick="Ask">Ask</button>

<div class="alert alert-secondary mt-3">@answer</div>

@code {
    string question;
    string answer;

    async Task Ask()
    {
        var embedding = await AI.CreateEmbeddingAsync(question);
        var context = await Search.SearchAsync(embedding);

        var prompt = $"""
        Answer using ONLY the context below.
        If not found, say "Data not available".

        Context:
        {context}

        Question:
        {question}
        """;

        answer = await AI.ImproveTextAsync(prompt);
    }
}